<!DOCTYPE html>
<html>
<head>
    <title>Vision Framework Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #065f46; }
        .error { background: #7f1d1d; }
        .info { background: #1e3a8a; }
        .debug { background: #374151; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîç Vision Framework Debug Tool</h1>
    
    <div class="test-section">
        <h2>Step 1: Test API Directly</h2>
        <button onclick="testAPI()">Test Vision Framework API</button>
        <div id="api-status" class="status info">Ready to test...</div>
        <div id="api-debug" class="debug"></div>
    </div>

    <div class="test-section">
        <h2>Step 2: Test Modal Creation</h2>
        <button onclick="testModal()">Test Vision Modal</button>
        <div id="modal-status" class="status info">Ready to test...</div>
    </div>

    <div class="test-section">
        <h2>Step 3: Test Complete Flow</h2>
        <button onclick="testCompleteFlow()">Test Complete Flow</button>
        <div id="flow-status" class="status info">Ready to test...</div>
        <div id="flow-debug" class="debug"></div>
    </div>

    <div class="test-section">
        <h2>Step 4: Check Browser Console</h2>
        <p>Open browser developer tools (F12) and check the Console tab for any JavaScript errors.</p>
        <button onclick="openNewPage()">Open /new Page</button>
        <button onclick="openFrameworkPage()">Open /vision-framework Page</button>
    </div>

    <script>
        const yardbirdData = {
            stage: "early_traction",
            problem_now: "Material deliveries to urban job sites are late/misplaced ~30% of the time, stalling crews and burning budget.",
            customer_gtm: "Mid-market GCs (50‚Äì500 employees) in NYC/Chicago/LA. Buyer = Ops Director; users = site supers + vendor drivers.",
            traction_proud: "2 paid pilots (GCs doing $200M/yr rev). 18 active sites; 1,240 drops coordinated; 27% fewer idle crew hours; NRR 118% on pilot add-ons.",
            milestone_6mo: "Scale to 50 active sites across 3 metros, achieve $500K ARR, and launch mobile app for foremen",
            cash_on_hand: 500000,
            monthly_burn: 25000,
            risky_assumption: "Contractors will adopt new scheduling software and vendors will comply with dynamic routing requirements."
        };

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function updateDebug(elementId, content) {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.className = 'debug';
        }

        async function testAPI() {
            updateStatus('api-status', 'Testing API...', 'info');
            
            try {
                const response = await fetch('/api/vision-framework/from-brief', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        briefData: yardbirdData,
                        visionPurpose: "Transform construction logistics through intelligent dispatch and eliminate delivery delays",
                        visionEndState: "Every construction site runs efficiently with zero delivery delays, reducing project costs by 15% and improving contractor satisfaction",
                        companyId: "yardbird-debug-test"
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    updateStatus('api-status', '‚úÖ API working! Framework created successfully', 'success');
                    updateDebug('api-debug', JSON.stringify(data, null, 2));
                } else {
                    updateStatus('api-status', '‚ùå API Error: ' + (data.error || 'Unknown error'), 'error');
                    updateDebug('api-debug', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                updateStatus('api-status', '‚ùå Network Error: ' + error.message, 'error');
                updateDebug('api-debug', error.stack);
            }
        }

        function testModal() {
            updateStatus('modal-status', 'Testing modal creation...', 'info');
            
            try {
                // Test if we can create a modal-like element
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #374151; padding: 20px; border-radius: 8px;">
                            <h3>Test Modal</h3>
                            <p>If you can see this, modal creation works!</p>
                            <button onclick="this.parentElement.parentElement.remove()">Close</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                updateStatus('modal-status', '‚úÖ Modal creation works! Close the test modal to continue.', 'success');
            } catch (error) {
                updateStatus('modal-status', '‚ùå Modal Error: ' + error.message, 'error');
            }
        }

        async function testCompleteFlow() {
            updateStatus('flow-status', 'Testing complete flow...', 'info');
            updateDebug('flow-debug', 'Starting complete flow test...\n');
            
            try {
                // Step 1: Generate brief
                updateDebug('flow-debug', 'Step 1: Generating brief...\n');
                const briefResponse = await fetch('/api/generate-brief', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ responses: yardbirdData })
                });
                
                if (!briefResponse.ok) {
                    throw new Error('Brief generation failed');
                }
                
                const briefData = await briefResponse.json();
                updateDebug('flow-debug', 'Brief generated successfully\n');
                
                // Step 2: Create vision framework
                updateDebug('flow-debug', 'Step 2: Creating vision framework...\n');
                const frameworkResponse = await fetch('/api/vision-framework/from-brief', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        briefData: yardbirdData,
                        visionPurpose: "Transform construction logistics through intelligent dispatch and eliminate delivery delays",
                        visionEndState: "Every construction site runs efficiently with zero delivery delays, reducing project costs by 15% and improving contractor satisfaction",
                        companyId: "yardbird-complete-test"
                    })
                });
                
                if (!frameworkResponse.ok) {
                    throw new Error('Vision framework creation failed');
                }
                
                const frameworkData = await frameworkResponse.json();
                updateDebug('flow-debug', 'Vision framework created successfully\n');
                
                // Step 3: Store in session storage
                updateDebug('flow-debug', 'Step 3: Storing in session storage...\n');
                sessionStorage.setItem('visionFrameworkDraft', JSON.stringify({
                    framework: frameworkData.framework,
                    fromBrief: true,
                    autoFilledFields: frameworkData.autoFilledFields,
                    frameworkId: frameworkData.frameworkId
                }));
                updateDebug('flow-debug', 'Stored in session storage successfully\n');
                
                updateStatus('flow-status', '‚úÖ Complete flow works! Check session storage and navigate to /vision-framework', 'success');
                updateDebug('flow-debug', 'Complete flow test successful!\n\nFramework ID: ' + frameworkData.frameworkId + '\nAuto-filled fields: ' + frameworkData.autoFilledFields.length + ' fields\n\nYou can now navigate to /vision-framework to see the result.');
                
            } catch (error) {
                updateStatus('flow-status', '‚ùå Flow Error: ' + error.message, 'error');
                updateDebug('flow-debug', 'Error in complete flow:\n' + error.stack);
            }
        }

        function openNewPage() {
            window.open('/new', '_blank');
        }

        function openFrameworkPage() {
            window.open('/vision-framework', '_blank');
        }

        // Auto-run API test on load
        window.addEventListener('load', function() {
            setTimeout(testAPI, 1000);
        });
    </script>
</body>
</html>
